{% assign item = include.item %}
{% assign parent = item.title | slugify %}
{% assign page_path_prefix = page.url | slice: 0, item.path.size %}
<li id="{{ parent }}" class="{% if item.items %}has-menu{% endif %} {% if page_path_prefix == item.path %}open{% endif %}">

  {% if item.items %}

    <a href="{{ item.path }}">{{ item.title }} {% if item.items %}<span class="caret"></span>{% endif %}</a>
    <ul class="nav-menu">
      {% assign subnav = item.items %}
      {% for item_hash in subnav %}
        {% assign item = item_hash[1] %}
        {% assign parent = item.title | slugify %}
        <li id="{{ parent }}" {% if item.items %}class="has-menu"{% endif %}>
          <a href="{{ item.path }}">{{ item.title }} {% if item.items %}<span class="caret"></span>{% endif %}</a>
          {% if item.items %}
            <ul class="nav-menu">
              {% assign subnav = item.items %}
              {% for item_hash in subnav %}
                {% assign item = item_hash[1] %}
                <li>
                  <a href="{{ item.path }}">{{ item.title }} {% if item.items %}<span class="caret"></span>{% endif %}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>

  {% else %}
    <a href="{{ item.path }}">{{ item.title }} {% if item.items %}<span class="caret"></span>{% endif %}</a>
  {% endif %}

</li>
